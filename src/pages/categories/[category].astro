---
import Layout from "@/layouts/main.astro";
import { ProjectCard } from "@/components/ProjectCard";
import {
  getAllCategories,
  getResourcesByCategory,
  getResourceName,
  getProjectMetadata,
} from "@/data/projects";
import type { GetStaticPaths } from "astro";

export const getStaticPaths = (() => {
  const categories = getAllCategories();
  return categories.map((category) => {
    const categorySlug = category.toLowerCase().replace(/\s+/g, "-");
    return {
      params: { category: categorySlug },
      props: { category, categorySlug },
    };
  });
}) satisfies GetStaticPaths;

const { category } = Astro.props;
const resources = getResourcesByCategory(category);
const metadata = getProjectMetadata();

// Transform resources to match ProjectCard props
const projects = resources.map((resource) => ({
  name: getResourceName(resource),
  description: resource.description,
  url: resource.url,
  category: resource.category,
  language: ("primaryLanguage" in resource ? resource.primaryLanguage : undefined) ||
    ("languages" in resource && Array.isArray(resource.languages) ? resource.languages[0] : undefined),
  stars: "stars" in resource ? resource.stars : undefined,
  license: "license" in resource ? resource.license : undefined,
  tags: resource.tags,
}));
---

<Layout
  title={`${category} - ${metadata.title}`}
  description={`Browse ${projects.length} awesome ${category.toLowerCase()} projects and resources from ${metadata.title}.`}
  keywords={[...metadata.keywords, category, "projects"]}
  author={metadata.author.name}
>
  <!-- Page Header -->
  <section class="border-b bg-gradient-to-b from-background to-secondary/20">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-16">
      <div class="max-w-3xl">
        <!-- Breadcrumb -->
        <nav class="flex items-center gap-2 text-sm text-muted-foreground mb-6">
          <a href="/" class="hover:text-foreground transition-colors">Home</a>
          <span>/</span>
          <a href="/categories" class="hover:text-foreground transition-colors">Categories</a>
          <span>/</span>
          <span class="text-foreground">{category}</span>
        </nav>

        <h1 class="text-4xl md:text-5xl font-bold tracking-tight mb-4">
          {category}
        </h1>
        <p class="text-xl text-muted-foreground">
          {projects.length} {projects.length === 1 ? "project" : "projects"} in this category.
        </p>
      </div>
    </div>
  </section>

  <!-- Quick Stats -->
  {projects.length > 0 && (
    <section class="border-b bg-background">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="flex flex-wrap gap-6 text-sm">
          <div class="flex items-center gap-2">
            <svg
              class="h-4 w-4 text-primary"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M3 3h18v18H3zM9 9h6v6H9z" />
            </svg>
            <span class="text-muted-foreground">
              <span class="font-semibold text-foreground">{projects.length}</span> projects
            </span>
          </div>
          <div class="flex items-center gap-2">
            <svg
              class="h-4 w-4 fill-yellow-400 stroke-yellow-400"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              stroke-width="2"
            >
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
            </svg>
            <span class="text-muted-foreground">
              <span class="font-semibold text-foreground">
                {projects
                  .reduce((sum, p) => sum + (p.stars || 0), 0)
                  .toLocaleString()}
              </span>{" "}
              total stars
            </span>
          </div>
          <div class="flex items-center gap-2">
            <svg
              class="h-4 w-4 text-primary"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
            <span class="text-muted-foreground">
              <span class="font-semibold text-foreground">
                {resources.filter((r) => r.featured).length}
              </span>{" "}
              featured
            </span>
          </div>
        </div>
      </div>
    </section>
  )}

  <!-- Projects Grid -->
  <section class="py-12 md:py-16">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      {projects.length > 0 ? (
        <>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {projects.map((project) => (
              <ProjectCard client:load {...project} />
            ))}
          </div>

          <!-- Back to Categories -->
          <div class="mt-12 text-center">
            <a
              href="/categories"
              class="inline-flex items-center justify-center rounded-lg text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring border border-input bg-background hover:bg-accent hover:text-accent-foreground h-11 px-6 gap-2"
            >
              <svg
                class="h-4 w-4"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="m12 19-7-7 7-7" />
                <path d="M19 12H5" />
              </svg>
              Browse All Categories
            </a>
          </div>
        </>
      ) : (
        <div class="text-center py-12">
          <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-secondary mb-4">
            <svg
              class="h-8 w-8 text-muted-foreground"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M12 2v20" />
              <path d="m19 9-7 7-7-7" />
            </svg>
          </div>
          <h3 class="text-lg font-semibold mb-2">No projects in this category yet</h3>
          <p class="text-muted-foreground mb-6">
            Check back later for new projects in {category}.
          </p>
          <a
            href="/categories"
            class="inline-flex items-center justify-center rounded-lg text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring border border-input bg-background hover:bg-accent hover:text-accent-foreground h-11 px-6"
          >
            Browse All Categories
          </a>
        </div>
      )}
    </div>
  </section>
</Layout>