---
import { Github } from "lucide-react";
import { ResourceCard } from "@/components/ResourceCard";
import Layout from "@/layouts/main.astro";
import {
  getAllCategories,
  getAllResources,
  getFeaturedResources,
  getProjectMetadata,
  getResourceName,
  getSEOMetadata,
  getTotalStars,
} from "@/lib/utils/data-access";

const allResources = getAllResources();
const featuredResources = getFeaturedResources();
const categories = getAllCategories();
const seoMetadata = getSEOMetadata();
const totalStars = getTotalStars();
const metadata = getProjectMetadata();

// Use featured resources or fallback to first 3 if no featured
const displayResources =
  featuredResources.length > 0 ? featuredResources.slice(0, 3) : allResources.slice(0, 3);

// Transform resources for display
const resourcesData = displayResources.map((resource) => ({
  id: resource.id,
  name: getResourceName(resource),
  description: resource.description,
  url: resource.url,
  type: resource.type,
  category: resource.category,
  language:
    ("primaryLanguage" in resource ? resource.primaryLanguage : undefined) ||
    ("languages" in resource && Array.isArray(resource.languages)
      ? resource.languages[0]
      : undefined),
  languages: "languages" in resource && Array.isArray(resource.languages) ? resource.languages : [],
  stars: "stars" in resource ? resource.stars : undefined,
  license: "license" in resource ? resource.license : undefined,
  tags: resource.tags,
  image: "image" in resource ? resource.image : undefined,
  imageAlt: "imageAlt" in resource ? resource.imageAlt : undefined,
  archived: resource.archived,
  trending: resource.trending,
  featured: resource.featured,
  registry: "package" in resource && resource.package ? resource.package.registry : undefined,
  packageName: "package" in resource && resource.package ? resource.package.name : undefined,
  lastReleaseVersion: "lastReleaseVersion" in resource ? resource.lastReleaseVersion : undefined,
  downloads: "downloads" in resource ? resource.downloads : undefined,
}));
---

<Layout
  title={seoMetadata.title}
  description={seoMetadata.description}
  keywords={seoMetadata.keywords}
  author={seoMetadata.author}
>
  <!-- Hero Section -->
  <section class="border-b bg-gradient-to-b from-background to-secondary/20">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-16 md:py-24">
      <div class="max-w-3xl mx-auto text-center space-y-6">
        <h1 class="text-4xl md:text-6xl font-bold tracking-tight">
          {metadata.title}
        </h1>
        <p class="text-xl text-muted-foreground max-w-2xl mx-auto">
          {metadata.description}
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center pt-4">
          <a
              href="/resources"
            class="inline-flex items-center justify-center rounded-lg text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring bg-primary text-primary-foreground hover:bg-primary/90 h-11 px-8"
          >
            Browse Resources
          </a>
          <a
              href="#about"
            class="inline-flex items-center justify-center rounded-lg text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring border border-input bg-background hover:bg-accent hover:text-accent-foreground h-11 px-8"
          >
            Learn More
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Stats Section -->
  <section class="border-b" id="stats">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div class="text-center">
          <div class="text-4xl font-bold text-primary">{allResources.length}</div>
          <div class="text-sm text-muted-foreground mt-2">Curated Resources</div>
        </div>
        <div class="text-center">
          <div class="text-4xl font-bold text-primary">{categories.length}</div>
          <div class="text-sm text-muted-foreground mt-2">Categories</div>
        </div>
        <div class="text-center">
          <div class="text-4xl font-bold text-primary">{totalStars.toLocaleString()}</div>
          <div class="text-sm text-muted-foreground mt-2">Total Stars</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Resources Section -->
  <section class="py-16 md:py-24" id="resources">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="space-y-4 mb-12">
        <h2 class="text-3xl font-bold tracking-tight">Featured Resources</h2>
        <p class="text-muted-foreground max-w-2xl">
          Handpicked selection of the best resources in this collection.
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {
          resourcesData.map((resource) => (
              <ResourceCard client:load {...resource}/>
          ))
        }
      </div>

      <div class="mt-12 text-center">
        <a
            href="/resources"
          class="inline-flex items-center justify-center rounded-lg text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring border border-input bg-background hover:bg-accent hover:text-accent-foreground h-11 px-8"
        >
          View All Resources
        </a>
      </div>
    </div>
  </section>

  <!-- About Section -->
  <section class="border-t bg-secondary/30" id="about">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-16 md:py-24">
      <div class="max-w-3xl mx-auto text-center space-y-6">
        <h2 class="text-3xl md:text-4xl font-bold tracking-tight">
          About This List
        </h2>
        <p class="text-lg text-muted-foreground">
          This curated collection is maintained to help you discover high-quality resources in {metadata.name}.
          All resources are carefully selected and regularly updated.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center pt-4">
          {metadata.repository?.url && (
              <a
                  href={metadata.repository.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center justify-center rounded-lg text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring bg-primary text-primary-foreground hover:bg-primary/90 h-11 px-8 gap-2"
              >
                <Github className="h-5 w-5"/>
                View on GitHub
              </a>
          )}
          <a
              href="#resources"
            class="inline-flex items-center justify-center rounded-lg text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring border border-input bg-background hover:bg-accent hover:text-accent-foreground h-11 px-8"
          >
            Explore Resources
          </a>
        </div>
      </div>
    </div>
  </section>
</Layout>
