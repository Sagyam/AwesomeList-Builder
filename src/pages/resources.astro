---
import {ResourcesBrowser} from "@/components/ResourcesBrowser";
import Layout from "@/layouts/main.astro";
import {
    getAllCategories,
    getAllLanguages,
    getAllLicenses,
    getAllResources,
    getProjectMetadata,
    getResourceName,
    rankResources,
} from "@/lib/utils/data-access";

const allResources = getAllResources();
const rankedResources = rankResources(allResources);
const metadata = getProjectMetadata();
const categories = getAllCategories();
const licenses = getAllLicenses();
const languages = getAllLanguages();

// Transform resources for display
const resourcesData = rankedResources.map((resource) => ({
  id: resource.id,
  name: getResourceName(resource),
  description: resource.description,
  url: resource.url,
    type: resource.type,
  category: resource.category,
  language:
    ("primaryLanguage" in resource ? resource.primaryLanguage : undefined) ||
    ("languages" in resource && Array.isArray(resource.languages)
      ? resource.languages[0]
      : undefined),
    languages: "languages" in resource && Array.isArray(resource.languages)
        ? resource.languages
        : [],
  stars: "stars" in resource ? resource.stars : undefined,
  license: "license" in resource ? resource.license : undefined,
  tags: resource.tags,
  image: "image" in resource ? resource.image : undefined,
  imageAlt: "imageAlt" in resource ? resource.imageAlt : undefined,
  archived: resource.archived,
  trending: resource.trending,
  featured: resource.featured,
    registry: "package" in resource && resource.package ? resource.package.registry : undefined,
    packageName: "package" in resource && resource.package ? resource.package.name : undefined,
    lastReleaseVersion: "lastReleaseVersion" in resource ? resource.lastReleaseVersion : undefined,
    downloads: "downloads" in resource ? resource.downloads : undefined,
}));
---

<Layout
        title={`Resources - ${metadata.title}`}
        description={`Browse our curated collection of ${resourcesData.length} awesome resources, libraries, tools, and guides.`}
        keywords={[...metadata.keywords, "resources", "browse"]}
        author={metadata.author.name}
>
    <!-- Page Header -->
    <section class="border-b bg-gradient-to-b from-background to-secondary/20">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-16">
            <div class="max-w-3xl">
                <h1 class="text-4xl md:text-5xl font-bold tracking-tight mb-4">
                    All Resources
                </h1>
                <p class="text-xl text-muted-foreground">
                    Browse our curated collection of {resourcesData.length} awesome resources, libraries, tools, and
                    guides.
                </p>
            </div>
        </div>
    </section>

    <!-- Resources Section -->
    <section class="py-12 md:py-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <ResourcesBrowser
                    client:load
                    resources={resourcesData}
                    categories={categories}
                    licenses={licenses}
                    languages={languages}
            />
        </div>
    </section>
</Layout>